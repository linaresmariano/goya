extends ../layout

block content
  link(rel='stylesheet', href='/stylesheets/report/offer.css')
  script(src='/js/lib/jquery.printThis.js')
  script.
    
    app.controller('offerCtrl', function ($scope, localStorageService, subjectService) {

      $scope.semester = !{JSON.stringify(semester)};

      $scope.courses = $scope.semester.courses.filter(shouldDisplayCourse)

      $scope.coursesTEST = [{'teacher': 'Eduardo Bonelli (PO)'},
        {'teacher': 'Eduardo Bonelli '},
        {'teacher': 'Pablo Factorovich (PI)'},
        {'teacher': 'Pablo Factorovich (PI)'},
      ]

      var weekday = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"]

      $scope.scheduleView = function(schedule) {
        return schedule.hour > 0 ?
          weekday[schedule.day]+" "+schedule.hour+":00 a "+(schedule.hour+schedule.duration)+":00" :
          ""
      }

      $scope.getArea = function(index) {
        return subjectService.areas[index].name
      }

      $scope.getCore = function(index) {
        return subjectService.cores[index].name
      }

      $scope.getModality = function(index) {
        return subjectService.modalities[index].name
      }

      function shouldDisplayCourse(course, index, ar) {
        if(course.schedules.length == 0) {
          return false
        }

        var someHour = false
        for (var i = course.schedules.length - 1; i >= 0; i--) {
          someHour = someHour || course.schedules[i].hour > 0
        }

        return someHour
      }
    })

  .container(ng-controller='offerCtrl')

    legend Generar reporte de Oferta Académica para el {{number}}º semestre de {{year}}

    div#report

      p#title(contenteditable="true") Oferta {{number}}º cuatrimestre de {{year}}
      p#title(contenteditable="true") Departamento: Ciencia y Tecnología
      p#title(contenteditable="true") Carrera: Tecnicatura en Programación Informática

      table#offer
        thead
          tr: th Área
              th Núcleo
              th Período
              th Modalidad
              th.col-md-1 Código Asignatura
              th Nombre Asignatura
              th Créditos
              th.col-md-2 Días y Horarios {{year}}
              th.col-md-2 Docente/s (Apellido y nombre completo)
              th Cupo
              th Grupo Carreras
              th.col-md-1 Nueva Asignatura Indicar para que Plan de Estudios se oferta
        tbody
          tr(ng-repeat='course in coursesTEST')
            td Programación
            td Básico Obligatorio
            td Cuatrimestral
            td Presencial
            td 00487
            td Introducción a la Programación
            td 18
            td  Lunes 9:00 a 11:30  Miércoles 10:00 a 13:00  Jueves 9:00 a 11:30
            td {{course.teacher}}
            td 30
            td P
            td No

          tr(ng-repeat='course in courses')
            td(contenteditable="true") {{getArea(course.subject.area) || '-'}}
            td(contenteditable="true") {{getCore(course.subject.core) || '-'}}
            td(contenteditable="true") {{course.subject.period || '-'}}
            td(contenteditable="true") {{getModality(course.subject.modality) || '-'}}
            td(contenteditable="true") {{course.subject.ocode || '-'}}
            td(contenteditable="true") {{course.subject.name}}
            td(contenteditable="true") {{course.subject.credits || '-'}}
            td(contenteditable="true")
              div(ng-repeat='schedule in course.schedules')
                {{scheduleView(schedule)}}
            td(contenteditable="true") {{course.semesterTeachers[0].teacher.name || '-'}}
            td(contenteditable="true") {{course.subject.capacity || '-'}}
            td(contenteditable="true") P
            td(contenteditable="true") No

    br
    button.btn.btn-success(onclick="$('#report').printThis()") Imprimir
